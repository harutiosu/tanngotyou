<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>苦手単語集</title>
  <style>
    body { font-family: sans-serif; margin: 20px; padding-top: 20px; padding-bottom: 50px;}
    table { border-collapse: collapse; width: 100%; margin-bottom: 24px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f7f7f7; }
    #resetBtn {
      position: fixed;
      bottom: 10px; 
      padding: 8px 16px; 
      font-size: 14px; 
      left: 10px;
    }
    #backBtn {
      position: fixed;
      top: 10px;       /* 左上に固定 */
      left: 10px;
      width: 40px;     /* 正方形にして丸くする */
      height: 40px;
      border-radius: 50%; /* 丸ボタン */
      border: none;
      background-color: #eee; /* 背景色はお好みで */
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background-color 0.2s;
    }
    #backBtn:hover {
      background-color: #ddd; /* ホバー時の色変化 */
    }
  </style>
</head>
<body>
  <h1>苦手単語集（正答率順）</h1>

  <h2>英単語</h2>
  <table>
    <thead>
      <tr><th>単語</th><th>意味</th><th>正答率</th></tr>
    </thead>
    <tbody id="statsEnglish"></tbody>
  </table>

  <h2>古文単語</h2>
  <table>
    <thead>
      <tr><th>単語</th><th>意味</th><th>正答率</th></tr>
    </thead>
    <tbody id="statsKobun"></tbody>
  </table>

  <button id="resetBtn">リセット</button>
  <button id="backBtn" onclick="location.href='index.html'">＜</button>

  <script>
    // 英単語用
    function loadEnglishStats() {
      const stats = JSON.parse(localStorage.getItem("stats_english")) || {};
      const tbody = document.getElementById("statsEnglish");

      let rows = Object.entries(stats).map(([word, data]) => {
        const total = data.correct + data.wrong;
        const rate = total > 0 ? (data.correct / total * 100).toFixed(1) : "0.0";
        return {
          word,
          meaning: data.meaning || "(意味未登録)",
          rate: parseFloat(rate)
        };
      });

      rows.sort((a, b) => a.rate - b.rate);

      tbody.innerHTML = rows.length === 0
        ? "<tr><td colspan='4'>データなし</td></tr>"
        : rows.map(r => `<tr><td>${r.word}</td><td>${r.meaning}</td><td>${r.rate}%</td></tr>`).join("");
    }

    // 古文用（kowordをキーに保存済み → answerを意味として表示）
    function loadKobunStats() {
      const stats = JSON.parse(localStorage.getItem("stats_kobun")) || {};
      const tbody = document.getElementById("statsKobun");

      let rows = Object.entries(stats).map(([word, data]) => {
        const total = data.correct + data.wrong;
        const rate = total > 0 ? (data.correct / total * 100).toFixed(1) : "0.0";
        return {
          word,
          meaning: data.answer || "(意味未登録)",
          rate: parseFloat(rate)
        };
      });

      rows.sort((a, b) => a.rate - b.rate);

      tbody.innerHTML = rows.length === 0
        ? "<tr><td colspan='4'>データなし</td></tr>"
        : rows.map(r => `<tr><td>${r.word}</td><td>${r.meaning}</td><td>${r.rate}%</td></tr>`).join("");
    }

    // リセット処理
    document.getElementById("resetBtn").addEventListener("click", () => {
      if (confirm("苦手単語データをすべて削除しますか？")) {
        localStorage.removeItem("stats_english");
        localStorage.removeItem("stats_kobun");
        loadEnglishStats();
        loadKobunStats();
      }
    });

    // 初期表示
    loadEnglishStats();
    loadKobunStats();
  </script>
</body>
</html>